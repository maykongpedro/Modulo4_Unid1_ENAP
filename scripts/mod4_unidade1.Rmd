---
title: "M√≥dulo 4 - Unidade 1 - Aplica√ß√£o da Linguagem R na An√°lise de Dados"
author: "Maykon Gabriel"
date: "05/01/2021"
output: 
    html_document:
        highlight: zenburn
        theme: simplex 
        number_sections: yes
        toc: yes
        toc_float:
          collapsed: no
          smooth_scroll: no
---
# Unidade 4
üéØ Objetivo de aprendizagem

A proposta deste t√≥pico √© colocar em pr√°tica algumas das fun√ß√µes do R trabalhando com a an√°lise de dados abertos de viagens a servi√ßo, com o intuito de subsidiar a tomada de medidas mais eficientes na redu√ß√£o dos gastos com os custos dessas viagens no setor p√∫blico.

# Defini√ß√£o do problema

Para resolver um problema, primeiramente temos que entend√™-lo. Assim, precisamos entender os gastos com viagens a servi√ßo para tomar medidas mais eficientes e, com isso, reduzir os custos dessas viagens.

Vamos levantar algumas quest√µes relevantes acerca dessa problem√°tica:

- **Qual √© o valor gasto por √≥rg√£o?**
- **Qual √© o valor gasto por cidade?**
- **Qual √© a quantidade de viagens por m√™s?**

## Dicion√°rio de dados
O Dicion√°rio encotra-se no seguinte link: [Dicion√°rio de Dados - Viagens a servi√ßo - Pagamentos](http://www.portaltransparencia.gov.br/pagina-interna/603364-dicion√°rio-de-dados-viagens-a-Servi√ßo-Pagamentos)


# Carregando pacotes
```{r carregar pacotes,warning=FALSE, message=FALSE}
# Carregando pacotes com pacman
if(!require("pacman")) install.packages("pacman")
pacman::p_load(vroom,lubridate,tidyverse,knitr, kableExtra, here)
```


# Obten√ß√£o dos dados
Para obter os dados, basta abrir o [Portal da Transpar√™ncia](http://www.portaltransparencia.gov.br/download-de-dados), ir em __Viagens a servi√ßo__, clicar no link do arquivo e selecionar o ano da consulta. Ap√≥s isso √© s√≥ baixar e abrir no R. Nesse exemplo vamos usar o Vroom, pacote para abrir rapidamente arquivos pesados em formato ".csv".

```{r importacao dos dados, warning=FALSE, message=FALSE}
# Carregando os dados com vroom, necess√°rio usar o par√¢metro "encode" por conta dos acentos no cabe√ßalho
viagens <- vroom(
  file = "../dados/2019_Viagem.csv", 
  delim = ";", 
  locale = vroom::locale(encoding = "WINDOWS-1252") )


# Ou com "here"
viagens <- vroom(
  file = here::here("dados","2019_Viagem.csv"), 
  delim = ";", 
  locale = vroom::locale(encoding = "WINDOWS-1252") )


# Ajustando o espa√ßo entre as palavras do cabe√ßalho
names(viagens) <-
  stringr::str_replace_all(
    string = names(viagens), 
    pattern = " ", 
    replacement = ".")
  
# Exibindo a tabela
rmarkdown::paged_table(viagens, options = list(rows.print = 10))

```


## Resumo dos valores de passagens
```{r resumo dos dados}
# Resumo da coluna de valor das passagens
summary(viagens$Valor.passagens)

```

## Tipo de dado de cada coluna
```{r tipo de dados}
# Descobrindo o tipo de dado de cada coluna
dplyr::glimpse(viagens)

```

# Transforma√ß√£o dos dados
√â importante ter em mente que, na linguagem R, diversas transforma√ß√µes nos dados coletados podem ser realizadas, a depender do tipo de dado e do objetivo da an√°lise.

## Datas
As colunas de `Per√≠odo...Data.de.in√≠cio` e `Per√≠odo...Data.de.fim` est√£o como `chr`, por√©m devem ser convertidas para data. No seguinte link tem algumas informa√ß√µes sobre formata√ß√£o de datas dentro do R: [Data Values](https://www.statmethods.net/input/dates.html)

```{r transf data}
# ? as.Date
# Convertendo colunas para data
viagens <- 
  viagens %>% 
  dplyr::mutate(`Per√≠odo.-.Data.de.fim` = as.Date(`Per√≠odo.-.Data.de.fim`, "%d/%m/%Y"),
         `Per√≠odo.-.Data.de.in√≠cio` = as.Date(`Per√≠odo.-.Data.de.in√≠cio`, "%d/%m/%Y"))

# Criando coluna "data.in√≠cio"
viagens$data.in√≠cio <- as.Date(viagens$`Per√≠odo.-.Data.de.in√≠cio`, "%d/%m/%Y")

# Formatando a data para Ano/M√™s
viagens$data.in√≠cio.formatada <- format(viagens$data.in√≠cio, "%Y-%m")

# Exibindo os primeiros valores da coluna criada
head(viagens$data.in√≠cio.formatada)

```

## N√∫meros
Um ponto negativo do `vroom` √© que normalmente ele carrega tudo como "chr" caso n√£o seja definido o tipo das colunas, ent√£o √© necess√°rio ajustar essas colunas para o tipo correto.
```{r transf numeros, warning=FALSE}

viagens <-
  viagens %>% 
  dplyr::mutate(`Valor.di√°rias` = as.double(`Valor.di√°rias`),
                `Valor.passagens` = as.double(`Valor.passagens`),
                `Valor.outros.gastos` = as.double(`Valor.outros.gastos`))

```


# Explora√ß√£o dos dados

## Histograma
```{r histograma, message=FALSE, warning=FALSE}
# hist(viagens$Valor.passagens, breaks = 50)
```








